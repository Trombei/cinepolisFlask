{% extends "base.html" %}
{% block content %}
<div class="max-w-2xl mx-auto bg-white p-8 rounded-xl shadow-lg border border-gray-200 mt-10">
    <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Comprar boletos para: {{ peli.titulo }}</h2>
    
    <form method="POST" class="space-y-6">
        {{ form.hidden_tag() }}
        
        <div>
            <label for="{{ form.nombre.id }}" class="block mb-2 text-sm font-medium text-gray-900">{{ form.nombre.label.text }}</label>
            {{ form.nombre(class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5") }}
        </div>

        <div>
            <label for="{{ form.correo.id }}" class="block mb-2 text-sm font-medium text-gray-900">{{ form.correo.label.text }}</label>
            {{ form.correo(class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5", type="email") }}
        </div>

        <div>
            <label for="{{ form.cantidad.id }}" class="block mb-2 text-sm font-medium text-gray-900">{{ form.cantidad.label.text }}</label>
            {{ form.cantidad(class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5", min="1", max="7", id="input-cantidad") }}
            {% for error in form.cantidad.errors %}
                <p class="mt-2 text-sm text-red-600"><span class="font-medium">Â¡Detalle!</span> {{ error }}</p>
            {% endfor %}
        </div>

        <div class="flex items-start">
            <div class="flex items-center h-5">
                {{ form.tarjeta_cineco(class="w-4 h-4 border border-gray-300 rounded bg-gray-50 focus:ring-3 focus:ring-blue-300", id="check-cineco") }}
            </div>
            <label for="check-cineco" class="ms-2 text-sm font-medium text-gray-900">{{ form.tarjeta_cineco.label.text }}</label>
        </div>

        <div class="p-5 mb-4 bg-gray-50 rounded-lg border border-gray-200 shadow-sm">
            <p class="text-sm text-gray-600 mb-2">Subtotal: $<span id="calc-sub">12.00</span> USD</p>
            <p class="text-sm text-green-600 mb-4 font-medium">Descuento aplicado (<span id="calc-porcentaje">0</span>%): -$<span id="calc-desc">0.00</span> USD</p>
            <div class="pt-4 border-t border-gray-200">
                <h3 class="text-xl font-bold text-gray-900">Total a Pagar: $<span id="calc-total">12.00</span> USD</h3>
            </div>
        </div>

        <div class="flex flex-col sm:flex-row gap-4">
            <a href="{{ url_for('movie', movie_id=peli.id) }}" class="text-gray-900 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 font-medium rounded-lg text-sm px-5 py-3 text-center w-full sm:w-1/2 transition-colors">Regresar</a>
            {{ form.submit(class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-3 text-center w-full sm:w-1/2 transition-colors") }}
        </div>
    </form>
</div>

<script>
    const precioBoleto = 12.0;
    const inputCantidad = document.getElementById('input-cantidad');
    const checkCineco = document.getElementById('check-cineco');
    
    const spanSub = document.getElementById('calc-sub');
    const spanDesc = document.getElementById('calc-desc');
    const spanPorc = document.getElementById('calc-porcentaje');
    const spanTotal = document.getElementById('calc-total');

    function actualizarPrecios() {
        let cantidad = parseInt(inputCantidad.value) || 0;
        
        if(cantidad < 0) cantidad = 0;
        if(cantidad > 7) cantidad = 7;

        let subtotal = cantidad * precioBoleto;
        let descuentoDecimal = 0.0;

        if (cantidad > 3) descuentoDecimal += 0.10;
        if (checkCineco.checked) descuentoDecimal += 0.10;

        let ahorro = subtotal * descuentoDecimal;
        let total = subtotal - ahorro;

        spanSub.innerText = subtotal.toFixed(2);
        spanDesc.innerText = ahorro.toFixed(2);
        spanPorc.innerText = (descuentoDecimal * 100).toFixed(0);
        spanTotal.innerText = total.toFixed(2);
    }

    inputCantidad.addEventListener('input', actualizarPrecios);
    checkCineco.addEventListener('change', actualizarPrecios);
    
    window.onload = actualizarPrecios;
</script>
{% endblock %}